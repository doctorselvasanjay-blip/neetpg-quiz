<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NEXT Mock Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f4f4f9; }
    h1, h2 { text-align:center; }
    .question { margin:20px 0; padding:15px; background:#fff; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .options button { display:block; margin:8px 0; padding:10px; width:100%; border:none; border-radius:6px; cursor:pointer; }
    .options button:hover { background:#eee; }
    .correct { background:#c8f7c5 !important; }
    .wrong { background:#f7c5c5 !important; }
    .explanation { margin-top:10px; font-size:14px; color:#333; }
    #scoreBox { font-size:18px; font-weight:bold; margin-top:20px; text-align:center; }
    #summary { display:none; padding:20px; background:#fff; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-top:20px; }
    #retryBtn { display:none; margin:20px auto; padding:10px 20px; background:#007BFF; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    #retryBtn:hover { background:#0056b3; }
    #sectionSelect { text-align:center; margin:20px; }
    #sectionSelect button { margin:10px; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; background:#28a745; color:#fff; }
    #sectionSelect button:hover { background:#1e7e34; }
  </style>
</head>
<body>
  <h1>NEXT Pattern Mock Test</h1>

  <div id="sectionSelect">
    <h2>Select Subject</h2>
    <button onclick="startTest('Medicine')">Medicine</button>
    <button onclick="startTest('Surgery')">Surgery</button>
    <button onclick="startTest('OBG')">OBG</button>
    <button onclick="startTest('Pediatrics')">Pediatrics</button>
    <button onclick="startTest('ENT')">ENT</button>
    <button onclick="startTest('Ophthalmology')">Ophthalmology</button>
  </div>

  <div id="quiz"></div>
  <div id="scoreBox"></div>
  <div id="summary"></div>
  <button id="retryBtn" onclick="resetQuiz()">Take Another Test</button>

  <script>
  // Global bank (loaded from questions.json)
  let questionBank = {};
  let score = 0, total = 0, currentSubject = "";

  // Load questions.json (with cache-bust to avoid GitHub Pages caching)
  async function loadBank() {
    if (Object.keys(questionBank).length) return; // already loaded
    const res = await fetch('questions.json?cb=' + Date.now());
    if (!res.ok) {
      alert('Could not load question bank (questions.json). Make sure it is in the repo root.');
      return;
    }
    questionBank = await res.json();
  }

  async function startTest(subject) {
    await loadBank();

    currentSubject = subject;
    document.getElementById("sectionSelect").style.display = "none";
    loadQuestions(subject);
  }

  function loadQuestions(subject) {
    const quizDiv = document.getElementById("quiz");
    quizDiv.innerHTML = "";
    document.getElementById("scoreBox").innerHTML = "";
    document.getElementById("summary").style.display = "none";
    document.getElementById("retryBtn").style.display = "none";
    score = 0;

    let questions;
    if (subject === "Full Mock") {
      // Mix from all available subjects
      const all = Object.values(questionBank).flat();
      if (!all.length) {
        quizDiv.innerHTML = "<p>No questions available yet. Upload/update questions.json.</p>";
        return;
      }
      questions = all;
    } else {
      questions = questionBank[subject] || [];
      if (!questions.length) {
        quizDiv.innerHTML = `<p>No questions available for <b>${subject}</b> yet. We’ll add them next.</p>`;
        return;
      }
    }

    // Shuffle (Fisher–Yates)
    for (let i = questions.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [questions[i], questions[j]] = [questions[j], questions[i]];
    }

    // Pick first 5 unique questions
    const selected = questions.slice(0, 5);
    total = selected.length;

    selected.forEach((qObj, i) => {
      const qDiv = document.createElement("div");
      qDiv.className = "question";
      qDiv.innerHTML = `<b>Q${i+1}. ${qObj.q}</b>`;

      const optDiv = document.createElement("div");
      optDiv.className = "options";

      qObj.options.forEach((opt, j) => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => {
          if (!btn.classList.contains("correct") && !btn.classList.contains("wrong")) {
            if (j === qObj.answer) {
              btn.classList.add("correct");
              score++;
            } else {
              btn.classList.add("wrong");
            }
            const exp = document.createElement("div");
            exp.className = "explanation";
            exp.textContent = qObj.explanation;
            qDiv.appendChild(exp);
            showScore();
          }
        };
        optDiv.appendChild(btn);
      });

      qDiv.appendChild(optDiv);
      quizDiv.appendChild(qDiv);
    });
  }

  function showScore() {
    document.getElementById("scoreBox").innerHTML = `Score: ${score}/${total}`;
    if (document.querySelectorAll(".explanation").length === total) {
      showSummary();
    }
  }

  function showSummary() {
    const summaryDiv = document.getElementById("summary");
    summaryDiv.style.display = "block";
    summaryDiv.innerHTML = `<h2>Result Summary</h2>
      <p>Subject: <b>${currentSubject}</b></p>
      <p>Score: <b>${score} / ${total}</b></p>`;
    document.getElementById("retryBtn").style.display = "block";
  }

  function resetQuiz() {
    document.getElementById("quiz").innerHTML = "";
    document.getElementById("scoreBox").innerHTML = "";
    document.getElementById("summary").style.display = "none";
    document.getElementById("retryBtn").style.display = "none";
    document.getElementById("sectionSelect").style.display = "block";
  }
</script>
<script>
  // Global bank (loaded from questions.json)
  let questionBank = {};
  let score = 0, total = 0, currentSubject = "";

  // Load questions.json (with cache-bust to avoid GitHub Pages caching)
  async function loadBank() {
    if (Object.keys(questionBank).length) return; // already loaded
    const res = await fetch('questions.json?cb=' + Date.now());
    if (!res.ok) {
      alert('Could not load question bank (questions.json). Make sure it is in the repo root.');
      return;
    }
    questionBank = await res.json();
  }

  async function startTest(subject) {
    await loadBank();

    currentSubject = subject;
    document.getElementById("sectionSelect").style.display = "none";
    loadQuestions(subject);
  }

  function loadQuestions(subject) {
    const quizDiv = document.getElementById("quiz");
    quizDiv.innerHTML = "";
    document.getElementById("scoreBox").innerHTML = "";
    document.getElementById("summary").style.display = "none";
    document.getElementById("retryBtn").style.display = "none";
    score = 0;

    let questions;
    if (subject === "Full Mock") {
      // Mix from all available subjects
      const all = Object.values(questionBank).flat();
      if (!all.length) {
        quizDiv.innerHTML = "<p>No questions available yet. Upload/update questions.json.</p>";
        return;
      }
      questions = all;
    } else {
      questions = questionBank[subject] || [];
      if (!questions.length) {
        quizDiv.innerHTML = `<p>No questions available for <b>${subject}</b> yet. We’ll add them next.</p>`;
        return;
      }
    }

    // Shuffle (Fisher–Yates)
    for (let i = questions.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [questions[i], questions[j]] = [questions[j], questions[i]];
    }

    // Pick first 5 unique questions
    const selected = questions.slice(0, 5);
    total = selected.length;

    selected.forEach((qObj, i) => {
      const qDiv = document.createElement("div");
      qDiv.className = "question";
      qDiv.innerHTML = `<b>Q${i+1}. ${qObj.q}</b>`;

      const optDiv = document.createElement("div");
      optDiv.className = "options";

      qObj.options.forEach((opt, j) => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => {
          if (!btn.classList.contains("correct") && !btn.classList.contains("wrong")) {
            if (j === qObj.answer) {
              btn.classList.add("correct");
              score++;
            } else {
              btn.classList.add("wrong");
            }
            const exp = document.createElement("div");
            exp.className = "explanation";
            exp.textContent = qObj.explanation;
            qDiv.appendChild(exp);
            showScore();
          }
        };
        optDiv.appendChild(btn);
      });

      qDiv.appendChild(optDiv);
      quizDiv.appendChild(qDiv);
    });
  }

  function showScore() {
    document.getElementById("scoreBox").innerHTML = `Score: ${score}/${total}`;
    if (document.querySelectorAll(".explanation").length === total) {
      showSummary();
    }
  }

  function showSummary() {
    const summaryDiv = document.getElementById("summary");
    summaryDiv.style.display = "block";
    summaryDiv.innerHTML = `<h2>Result Summary</h2>
      <p>Subject: <b>${currentSubject}</b></p>
      <p>Score: <b>${score} / ${total}</b></p>`;
    document.getElementById("retryBtn").style.display = "block";
  }

  function resetQuiz() {
    document.getElementById("quiz").innerHTML = "";
    document.getElementById("scoreBox").innerHTML = "";
    document.getElementById("summary").style.display = "none";
    document.getElementById("retryBtn").style.display = "none";
    document.getElementById("sectionSelect").style.display = "block";
  }
</script>

</body>
</html>
